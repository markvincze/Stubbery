<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Setting up preconditions </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Setting up preconditions ">
    <meta name="generator" content="docfx 2.1.0.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <ul class="nav level1 navbar-nav">
                <li>
                  <a href="../index.html" title="Home">Home</a>
                </li>
              </ul>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
              <a href="https://github.com/markvincze/Stubbery/blob/docs/docs/documentation/preconditions.md/#L1" class="btn btn-primary pull-right mobile-hide">Improve this Doc</a>
              <h1 id="setting-up-preconditions">Setting up preconditions</h1>
              
<p>When configuring a stubbed endpoint, various preconditions can be configured, so the stub only responds if the conditions are met.
The conditions can chained together with a fluent api.</p>
<h2 id="http-methods">HTTP methods</h2>
<p>For requiring the most common methods, the <code>Get</code>, <code>Post</code>, <code>Put</code> and <code>Delete</code> methods can be used.</p>
<pre><code class="lang-csharp">// Will match a GET
sut.Get(&quot;/testget&quot;, (req, args) =&gt; &quot;testresponse&quot;);

// Will match a POST
sut.Post(&quot;/testpost&quot;, (req, args) =&gt; &quot;testresponse&quot;);
</code></pre>
<p>If another method is needed, the <code>Request</code> method can be used.</p>
<pre><code class="lang-csharp"> // Will respond to OPTIONS
sut.Request(HttpMethod.Options)
    .IfRoute(&quot;/testoptions&quot;)
    .Response((req, args) =&gt; &quot;testresponse&quot;);
</code></pre>
<h2 id="headers">Headers</h2>
<p>The presence of specific headers can be required with the <code>IfHeader</code> method.</p>
<pre><code class="lang-csharp">// Will only respond if the Origin header with the given value is present.
sut.Get(&quot;/testget&quot;, (req, args) =&gt; &quot;testresponse&quot;)
    .IfHeader(&quot;Origin&quot;, &quot;http://www.example.com&quot;);
</code></pre>
<h2 id="body">Body</h2>
<p>We can specify requirements against the request body by calling the <code>IfBody</code> method. </p>
<pre><code class="lang-csharp">// Will only respond if the body contains the string &quot;bodyCondition&quot;.
sut.Post(&quot;/testget&quot;, (req, args) =&gt; &quot;testresponse&quot;)
    .IfBody(s =&gt; s.ReadAsString().Contains(&quot;bodyCondition&quot;));
</code></pre>
<h2 id="route">Route</h2>
<p>If we only want to respond on a particular path, we can pass a route template to the <code>Get</code>, <code>Post</code>, <code>Put</code> and <code>Delete</code> methods, or we can call the <code>IfRoute</code> method. </p>
<pre><code class="lang-csharp">// Will only respond if the request path is &quot;/testget&quot;.
sut.Request(HttpMethod.Get)
    .IfRoute(&quot;/testget&quot;)
    .Response((req, args) =&gt; &quot;testresponse&quot;);
</code></pre>
<h3 id="route-arguments">Route arguments</h3>
<p>Matching route templates is implemented by using the <a href="https://docs.asp.net/en/latest/fundamentals/routing.html#template-routes">built-in routing</a> of ASP.NET, the same syntax can be used here.
If we chain multiple route templates, the first matching one will be used to extract the route arguments.</p>
<p>The arguments are accessible when we setup the response through the <code>Route</code> property of <code>RequestArguments</code>.</p>
<pre><code class="lang-csharp">sut.Request(HttpMethod.Get)
    .IfRoute(&quot;/testget/{myArg}&quot;)
    .Response((req, args) =&gt; $&quot;testresponse arg: {args.Route.myArg}&quot;);
</code></pre>
<h2 id="chaining-multiple-conditons">Chaining multiple conditons</h2>
<p>An arbitrary number of preconditions can be chained together in a fluent fashion.
If we specify multiple header conditions, the stubb will only respond if all of them are satisfied.
The other types of conditions are considered satisfied is at least on of them matches.</p>
<pre><code class="lang-csharp">sut.Get(&quot;/testget1/{arg1}&quot;, (req, args) =&gt; $&quot;testresponse, {args.Route.arg2}&quot;)
    .IfHeader(&quot;Header1&quot;, &quot;TestValue1&quot;)
    .IfHeader(&quot;Header2&quot;, &quot;TestValue2&quot;)
    .IfContentType(&quot;custom/stubbery&quot;)
    .IfAccept(&quot;custom/accept&quot;)
    .IfRoute(&quot;/testget2/{arg2}&quot;)
    .StatusCode(StatusCodes.Status300MultipleChoices)
    .Header(&quot;ResponseHeader1&quot;, &quot;ResponseValue1&quot;)
    .Header(&quot;ResponseHeader2&quot;, &quot;ResponseValue2&quot;);
</code></pre>

            </article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
            <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
            </nav>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Copyright © 2016 Mark Vincze<br>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>
